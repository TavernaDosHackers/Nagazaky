import requests

from difflib import SequenceMatcher
from src.core.settings import colors

class SearchExploit:
    SE_config = {"name": "Search Exploit", "description": "Search Exploit!", "command": ["-SE", "--search-exploit"]}

    def SE_search_for_CMS(CMS):
        request = requests.get(f"http://www.exploitalert.com/api/search-exploit?name={CMS}").json()

        for x in range(0, 30):
            print(request[x])

    def SE_search_name_filter(name):
        request_wordpress = requests.get(f"http://www.exploitalert.com/api/search-exploit?name=Wordpress").json()
        request_joomla = requests.get(f"http://www.exploitalert.com/api/search-exploit?name=Joomla").json()
        request_drupal = requests.get(f"http://www.exploitalert.com/api/search-exploit?name=Drupal").json()

        print(f"{colors.GREEN}[+] {colors.RESET}Falhas {colors.BLUE}Wordpress{colors.RESET}")
        for x in range(0, len(request_wordpress)):
            if SequenceMatcher(None, name, request_wordpress[x]["name"]).ratio() >= 0.3 and x <= 30:
                id = request_wordpress[x]["id"]
                date = request_wordpress[x]["date"]
                name = request_wordpress[x]["name"]

                print(f"{id} - {date} - {name}")

        print(f"\n{colors.GREEN}[+] {colors.RESET}Falhas {colors.GREEN}Jo{colors.YELLOW}o{colors.RED}m{colors.BLUE}la{colors.RESET}")
        for x in range(0, len(request_joomla)):
            if SequenceMatcher(None, name, request_joomla[x]["name"]).ratio() >= 0.3 and x <= 30:
                id = request_joomla[x]["id"]
                date = request_joomla[x]["date"]
                name = request_joomla[x]["name"]

                print(f"{id} - {date} - {name}")

        print(f"\n{colors.GREEN}[+] {colors.RESET}Falhas Drupal")
        for x in range(0, len(request_joomla)):
            if SequenceMatcher(None, name, request_drupal[x]["name"]).ratio() >= 0.3 and x <= 10:
                id = request_drupal[x]["id"]
                date = request_drupal[x]["date"]
                name = request_drupal[x]["name"]

                print(f"{id} - {date} - {name}")